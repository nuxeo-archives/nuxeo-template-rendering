<?xml version="1.0"?>
<component name="org.nuxeo.platform.TemplateSources.operations" version="1.0">

  <documentation>
  Contribute Operation to encapsulate TemplateProcessor rendering features
  @author Tiry (tdelprat@nuxeo.com)</documentation>

  <extension target="org.nuxeo.ecm.core.operation.OperationServiceComponent"
    point="operations">

    <operation
      class="org.nuxeo.template.automation.RenderWithTemplateOperation" />
    <operation
      class="org.nuxeo.template.automation.DetachTemplateOperation" />

  </extension>

  <extension target="org.nuxeo.automation.scripting.internals.AutomationScriptingComponent" point="operation">

    <scriptedOperation id="javascript.FilterTemplatesByType">
      <inputType>document</inputType>
      <outputType>documents</outputType>
      <category>javascript</category>
      <description>Filter templates according to the type of a given input document.</description>
      <script><![CDATA[
        function run(input, params) {
          return Repository.Query(null, {
            'query': 'select * from Document where ecm:mixinType = "Template" AND ecm:currentLifeCycleState != "deleted" AND tmpl:applicableTypes IN ( "all", "' + input['type'] + '")'
          });
        }
      ]]></script>
    </scriptedOperation>
    
  </extension>
  
</component>
